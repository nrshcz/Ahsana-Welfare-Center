<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="shortcut icon" href="#">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Login Donor</title>
  <link href="https://fonts.googleapis.com/css?family=Karla:400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.materialdesignicons.com/4.8.95/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/login.css">
</head>

<style>

</style>

<body>
  <br>
  <h4>Please insert your registered email</h4>
  <input type="text" name="" id="resetEmail"><br>
  <button id="reset">Reset password now</button>
</body>

<!-- <script type="module">

  let reset = document.querySelector("#reset")
  reset.addEventListener("click", function(){

    let email = document.querySelector("#resetEmail")

    const auth = getAuth();
    sendPasswordResetEmail(auth, email.value)
  .then(() => {
    console.log("Reset Password Link Sent To Your Email")
    // Password reset email sent!
    // ..
  })
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;
    // ..
  });

  })

</script> -->
<script type="module">
// Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-auth.js";

// Your web app's Firebase configuration
const firebaseConfig = {
  // Your config details here
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const auth = getAuth(app);

// Add event listener to the reset button
document.getElementById('reset').addEventListener('click', function() {
  const userEmail = document.getElementById('email').value;
  resetPassword(userEmail);
});

// Function to reset the user's password
async function resetPassword(email) {
  try {
    // Check if the user exists in the database
    const usersRef = ref(database, 'users');
    const query = await onValue(usersRef);
    const users = query.val();
  
    const user = Object.values(users).find(u => u.email === email);
    if (!user) {
      alert('User with the provided email does not exist.');
      return;
    }
  
    // Get the user's Firebase UID
    const userId = user.uid;
  
    // Send password reset email
    await sendPasswordResetEmail(auth, email);
  
    alert('Password reset email sent successfully!');
  } catch (error) {
    alert('Error resetting password:', error.message);
  }
}
</script>