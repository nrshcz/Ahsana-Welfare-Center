<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="#">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sign Up for Ahsana</title>

    <!-- Font Icon -->
    <link rel="stylesheet" href="fonts/material-icon/css/material-design-iconic-font.min.css">

    <!-- Main css -->
    <link rel="stylesheet" href="css/style.css">
    <style type="text/css">
        .errArea label{
            color: #bf0404;
            font-size: 11px;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <div class="main">
        <div class="container">
            <div class="signup-content">
                <div class="signup-img">
                    <img src="images/signup-img.jpg" alt="">
                </div>
                <div class="signup-form">
                   <form class="register-form" id="register-form">
                        <h2>Admin Registration</h2>
                        <div class="form-row">

                            
                            <div class="form-group">
                                <label for="name">First Name :</label>
                                <input type="text" name="firstname" id="firstname"/>
                                <div class="errArea"></div>
                            </div>
                            <div class="form-group">
                                <label for="father_name">Last Name :</label>
                                <input type="text" name="lastname" id="lastname"/>
                                <div class="errArea"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="address">Address :</label>
                            <input type="text" name="address" id="address"/>
                            <div class="errArea"></div>
                        </div>
                        <div class="form-radio">
                            <label for="gender" class="radio-label">Gender :</label>
                            <div class="form-radio-item">
                                <input type="radio" name="gender" id="male" checked value="male">
                                <label for="male">Male</label>
                                <span class="check"></span>
                            </div>
                            <div class="form-radio-item">
                                <input type="radio" name="gender" id="female" value="female">
                                <label for="female">Female</label>
                                <span class="check"></span>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="state">State :</label>
                                <div class="form-select">
                                    <select name="state" id="state">
                                        <option value="kl">Kuala Lumpur</option>
                                        <option value="jr">Johor</option>
                                        <option value="kh">Kedah</option>
                                        <option value="kln">Kelantan</option>
                                        <option value="mlk">Malacca</option>
                                        <option value="ns">Negeri Sembilan</option>
                                        <option value="ph">Pahang</option>
                                        <option value="png">Penang</option>
                                        <option value="pk">Perak</option>
                                        <option value="prs">Perlis</option>
                                        <option value="sb">Sabah</option>
                                        <option value="sr">Sarawak</option>
                                        <option value="sl">Selangor</option>
                                        <option value="trg">Terengganu</option>
                                        <option value="lb">Labuan</option>
                                        <option value="pj">Putrajaya</option>
                                    </select>
                                    <span class="select-icon"><i class="zmdi zmdi-chevron-down"></i></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="name">City :</label>
                                <input type="text" name="city" id="city"/>
                                <div class="errArea"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Postcode">Postcode :</label>
                            <input type="text" name="postcode" id="postcode">
                            <div class="errArea"></div>
                        </div>
                        <div class="form-group">
                            <label for="birth_date">Date Of Birth :</label>
                            <input type="date" name="birth_date" id="birth_date">
                            <div class="errArea"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Email :</label>
                            <input type="email" name="email" id="email" />
                            <div class="errArea"></div>
                        </div>
                        <div class="form-group">
                            <label for="password">Password :</label>
                            <input type="password" name="password" id="password" />
                            <div class="errArea"></div>
                        </div>
                        <div class="form-group">
                            <label for="phoneNum">Phone Number :</label>
                            <input type="text" name="phoneNum" id="phoneNum" />
                            <div class="errArea"></div>
                        </div>
                        
                       
                        <div class="form-submit">
                            <input type="button" value="Reset All" class="submit" name="reset" id="reset" />
                            <input type="button" value="Submit Form" class="submit" name="submit" id="signUp" />
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <!-- JS -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/jquery/jquery-validate.min.js"></script>
    <!-- <script src="js/main.js"></script> -->
    <!-- <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase.js"></script> -->
    <!-- <script src="main.js"></script> -->

</body>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
    import { getDatabase, set, ref} from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-auth.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    const firebaseConfig = {

        apiKey: "AIzaSyAnRXDaONlj8ebUzJh-8veX1GtgI9IF3Hs",
      
        authDomain: "ahsana-welfare-center-52143.firebaseapp.com",
      
        databaseURL: "https://ahsana-welfare-center-52143-default-rtdb.firebaseio.com",
      
        projectId: "ahsana-welfare-center-52143",
      
        storageBucket: "ahsana-welfare-center-52143.appspot.com",
      
        messagingSenderId: "52579977535",
      
        appId: "1:52579977535:web:d259c9b4952431c5daab8a"
      
      };
  
    // Initialize Firebase


    $('document').ready(function(){

        $(".register-form").validate({
            rules:{
                firstname:{
                    required: true
                },
                lastname:{
                    required:true
                },
                address:{
                    required:true
                },
                city:{
                    required:true
                },
                postcode:{
                    required:true
                }
                ,
                birth_date: {
                    required: true
                },
                email: {
                    required: true,
                    email: true
                },
                password: {
                    required: true,
                },
                phoneNum: {
                    required: true,
                }
            },
            errorPlacement: function (error, element) {
                error.appendTo(element.closest(".form-group").find(".errArea"));
            }
        });

        $('#signUp').on('click', function(){

            if($(".register-form").valid()){
                registerAcc();
            }

        });


    });

    function registerAcc(){

        $('#signUp').prop('disabled', true);
        var email = $('#email').val();
        var password = $('#password').val();
        var firstname = $('#firstname').val();
        var lastname = $('#lastname').val();
        var address = $('#address').val();
        var state = $('#state option:selected').val();
        var city = $('#city').val();
        var postcode = $('#postcode').val();
        var birth_date = $('#birth_date').val();
        var phoneNum = $('#phoneNum').val();
        var gender = $('input[name="gender"]:checked').val();
        var donor = "admin";

        const app = initializeApp(firebaseConfig);
        // const database = getDatabase(app);
        const auth = getAuth(app);
        const db = getDatabase(app);



        createUserWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            // Signed in 
            const user = userCredential.user;

            set(ref(db, 'donors/' + user.uid), {
                email: email,
                firstname: firstname,
                lastname: lastname,
                address: address,
                state: state,
                city: city, 
                postcode: postcode,
                birth_date: birth_date,
                phone: phoneNum,
                gender: gender,
                role: donor,
            }).then(() => {
              alert('Successfully register new admin account');
              window.location.reload();
            })
            .catch((err) => {
              alert(err.message);
            });

            // alert('Successfully register new donor account');
            // window.location.reload();
            // console.log("created");
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;

            
            // ..
            alert(errorCode + errorMessage);
          });



    }


  </script>


</html>